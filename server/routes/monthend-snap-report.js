const express = require('express')
const router = express.Router()
const db = require('../db/redshift/index')


router.get('/', (req, res, next) => {
    const getMonthendReport = {
        name: 'fetch-page',
        text: 'select distinct T1060758.FULL_DT as c1, T1060752.DEPT_ID as c2, T1060752.DEPT_NM as c3, T1060752.FINC_LVL_1_DESC as c4, T1060752.FINC_LVL_10_DESC as c5, T1060752.FINC_LVL_11_DESC as c6, T1060752.FINC_LVL_12_DESC as c7, T1060752.FINC_LVL_13_DESC as c8, T1060752.FINC_LVL_14_DESC as c9, T1060752.FINC_LVL_15_DESC as c10, T1060752.FINC_LVL_2_DESC as c11, T1060752.FINC_LVL_3_DESC as c12, T1060752.FINC_LVL_4_DESC as c13, T1060752.FINC_LVL_5_DESC as c14, T1060752.FINC_LVL_6_DESC as c15, T1060752.FINC_LVL_7_DESC as c16, T1060752.FINC_LVL_8_DESC as c17, T1060752.FINC_LVL_9_DESC as c18, T1060728.ALT_EMP_ID as c19, T1060728.BRTH_MMDD_DT as c20, T1060728.EMP_ID as c21, T1060728.ENT_USER_ID as c22, T1060728.FRST_NM as c23, T1060728.FULL_NM as c24, T1060728.LAST_NM as c25, T1060728.MID_NM as c26, T1060728.PRFX_NM as c27, T1060728.WORK_EMAIL_ADR_TXT as c28, T1060740.ACQN_CMPY_NM as c29, T1060740.ACQN_IND as c30, T1060740.ACQN_LEGAL_DAY_1_DT as c31, T1060740.ASSOC_TYPE_DESC as c32, T1060740.BUS_UNIT_CD as c33, T1060740.BUS_UNIT_NM as c34, T1060740.CMPY_CD as c35, T1060740.CMPY_NM as c36, T1060740.EMP_CLASS_DESC as c37, T1060740.EMP_STATUS_CD as c38, T1060740.EMP_STATUS_DESC as c39, T1060740.EMP_TYPE_DESC as c40, T1060740.EXTRNL_HIRE_IND as c41, T1060740.FTE_NUM as c42, T1060740.FULL_PART_TM_CD as c43, T1060740.HEAD_CNT_IND as c44, T1060740.INTERNAL_ZIP_ID as c45, T1060740.INVOL_NONRIF_ATRTN_IND as c46, T1060740.INVOL_RIF_ATRTN_IND as c47, T1060740.PPL_MGR_IND as c48, T1060719.DEPT_ID as c49, T1060719.DEPT_NM as c50, T1060722.EC_NM as c51, T1060722.EC1_NM as c52, T1060722.EC2_NM as c53, T1060722.EC3_NM as c54, T1060722.EC4_NM as c55, T1060722.EC5_NM as c56, T1060722.EC6_NM as c57, T1060722.EC7_NM as c58, T1060722.EC8_NM as c59, T1060722.EC9_NM as c60, T1060746.FLSA_STAT_DESC as c61, T1060746.JOB_CD as c62, T1060746.JOB_FMLY_DESC as c63, T1060746.JOB_LVL_CD as c64, T1060746.JOB_LVL_DESC as c65, T1060746.JOB_DESC as c66, T1060724.LOC_CD as c67, T1060724.LOC_NM as c68, T1060719.FINC_LVL_1_DESC as c69, T1060719.FINC_LVL_10_DESC as c70, T1060719.FINC_LVL_11_DESC as c71, T1060719.FINC_LVL_12_DESC as c72, T1060719.FINC_LVL_13_DESC as c73, T1060719.FINC_LVL_14_DESC as c74, T1060719.FINC_LVL_15_DESC as c75, T1060719.FINC_LVL_2_DESC as c76, T1060719.FINC_LVL_3_DESC as c77, T1060719.FINC_LVL_4_DESC as c78, T1060719.FINC_LVL_5_DESC as c79, T1060719.FINC_LVL_6_DESC as c80, T1060719.FINC_LVL_7_DESC as c81, T1060719.FINC_LVL_8_DESC as c82, T1060719.FINC_LVL_9_DESC as c83, T1060724.WORK_CITY_NM as c84, T1060724.WORK_CNTRY_NM as c85, T1060724.WORK_ST_CD as c86, T1060724.WORK_ZIP_CD as c87, T1060740.TRFR_IND as c88, T1060740.VOL_ATRTN_IND as c89, T1060769.FULL_DT as c90, T1060732.FULL_DT as c91, T1060723.FLSA_STAT_DESC as c92, T1060723.JOB_CD as c93, T1060723.JOB_FMLY_DESC as c94, T1060723.JOB_LVL_CD as c95, T1060723.JOB_LVL_DESC as c96, T1060723.JOB_DESC as c97, T1060727.FULL_DT as c98, T1060763.LOC_CD as c99, T1060763.LOC_NM as c100, T1060763.WORK_CITY_NM as c101, T1060763.WORK_CNTRY_NM as c102, T1060763.WORK_ST_CD as c103, T1060763.WORK_ZIP_CD as c104, T1060740.PROMO_IND as c105, T1060744.FULL_DT as c106, T1060742.EC_NM as c107, T1060742.EC1_NM as c108, T1060742.EC2_NM as c109, T1060742.EC3_NM as c110, T1060742.EC4_NM as c111, T1060742.EC5_NM as c112, T1060742.EC6_NM as c113, T1060742.EC7_NM as c114, T1060742.EC8_NM as c115, T1060742.EC9_NM as c116, T1060745.FULL_DT as c117, T1060738.FULL_DT as c118, case when T1060740.ACTUAL_LAST_DAY_OF_LEAVE is null then NULL else T1060740.ACTUAL_LAST_DAY_OF_LEAVE end as c119, case when T1060740.LAST_DAY_OF_WORK is null then NULL else T1060740.LAST_DAY_OF_WORK end as c120, case when not T1060742.EC10_NM is null then T1060742.EC10_ID else case when not T1060742.EC9_NM is null then T1060742.EC9_ID else case when not T1060742.EC8_NM is null then T1060742.EC8_ID else case when not T1060742.EC7_NM is null then T1060742.EC7_ID else case when not T1060742.EC6_NM is null then T1060742.EC6_ID else case when not T1060742.EC5_NM is null then T1060742.EC5_ID else case when not T1060742.EC4_NM is null then T1060742.EC4_ID else case when not T1060742.EC3_NM is null then T1060742.EC3_ID else case when not T1060742.EC2_NM is null then T1060742.EC2_ID else case when not T1060742.EC1_NM is null then T1060742.EC1_ID else case when not T1060742.EC_NM is null then T1060742.EC_ID else case when not T1060742.CEO_NM is null then T1060742.CEO_ID else NULL end end end end end end end end end end end end as c121, case when not T1060742.EC10_NM is null then T1060742.EC10_NM else case when not T1060742.EC9_NM is null then T1060742.EC9_NM else case when not T1060742.EC8_NM is null then T1060742.EC8_NM else case when not T1060742.EC7_NM is null then T1060742.EC7_NM else case when not T1060742.EC6_NM is null then T1060742.EC6_NM else case when not T1060742.EC5_NM is null then T1060742.EC5_NM else case when not T1060742.EC4_NM is null then T1060742.EC4_NM else case when not T1060742.EC3_NM is null then T1060742.EC3_NM else case when not T1060742.EC2_NM is null then T1060742.EC2_NM else case when not T1060742.EC1_NM is null then T1060742.EC1_NM else case when not T1060742.EC_NM is null then T1060742.EC_NM else case when not T1060742.CEO_NM is null then T1060742.CEO_NM else NULL end end end end end end end end end end end end as c122, case when not T1060742.EC10_NM is null then T1060742.EC10_WORK_EMAIL_ADR_TXT else case when not T1060742.EC9_NM is null then T1060742.EC9_WORK_EMAIL_ADR_TXT else case when not T1060742.EC8_NM is null then T1060742.EC8_WORK_EMAIL_ADR_TXT else case when not T1060742.EC7_NM is null then T1060742.EC7_WORK_EMAIL_ADR_TXT else case when not T1060742.EC6_NM is null then T1060742.EC6_WORK_EMAIL_ADR_TXT else case when not T1060742.EC5_NM is null then T1060742.EC5_WORK_EMAIL_ADR_TXT else case when not T1060742.EC4_NM is null then T1060742.EC4_WORK_EMAIL_ADR_TXT else case when not T1060742.EC3_NM is null then T1060742.EC3_WORK_EMAIL_ADR_TXT else case when not T1060742.EC2_NM is null then T1060742.EC2_WORK_EMAIL_ADR_TXT else case when not T1060742.EC1_NM is null then T1060742.EC1_WORK_EMAIL_ADR_TXT else case when not T1060742.EC_NM is null then T1060742.EC_WORK_EMAIL_ADR_TXT else case when not T1060742.CEO_NM is null then T1060742.CEO_WORK_EMAIL_ADR_TXT else NULL end end end end end end end end end end end end as c123 from phrdw_tb.DEPT_DIM T1060719 , phrdw_tb.JOB_DIM T1060723, phrdw_tb.DT_DIM T1060745, phrdw_tb.DT_DIM T1060758, phrdw_tb.RPTS_TO_DIM T1060742, phrdw_tb.DT_DIM T1060732, phrdw_tb.RPTS_TO_DIM T1060722, phrdw_tb.DT_DIM T1060729, phrdw_tb.LOC_DIM T1060724, phrdw_tb.JOB_DIM T1060746, phrdw_tb.LOC_DIM T1060763, phrdw_tb.DT_DIM T1060738, phrdw_tb.DT_DIM T1060744, phrdw_tb.DEPT_DIM T1060752, phrdw_tb.DT_DIM T1060727, phrdw_tb.DT_DIM T1060769, phrdw_tb.EMP_DIM T1060728, phrdw_tb.EMP_EOM_FACT T1060740 where( T1060719.DEPT_DIM_ID = T1060740.PREV_DEPT_DIM_ID and T1060723.JOB_DIM_ID = T1060740.JOB_DIM_ID and T1060740.RPTS_TO_DIM_ID = T1060742.RPTS_TO_DIM_ID and T1060732.DT_DIM_ID = nvl(T1060740.JOB_ENTRY_DT_DIM_ID , 0) and T1060722.RPTS_TO_DIM_ID = T1060740.PREV_RPTS_TO_DIM_ID and T1060729.DT_DIM_ID = T1060740.DT_DIM_ID and T1060724.LOC_DIM_ID = T1060740.PREV_LOC_DIM_ID and T1060740.PREV_JOB_DIM_ID = T1060746.JOB_DIM_ID and T1060740.LOC_DIM_ID = T1060763.LOC_DIM_ID and T1060738.DT_DIM_ID = T1060740.TERM_DT_DIM_ID and T1060740.ORIG_HIRE_DT_DIM_ID = T1060744.DT_DIM_ID and T1060740.DEPT_DIM_ID = T1060752.DEPT_DIM_ID and T1060727.DT_DIM_ID = T1060740.LAST_HIRE_DT_DIM_ID and T1060740.EXPECTD_RETURN_DT_DIM_ID = T1060769.DT_DIM_ID and T1060728.EMP_DIM_ID = T1060740.EMP_DIM_ID and T1060729.YYMM_NUM = $1 and T1060740.SERVICE_DT_DIM_ID = T1060745.DT_DIM_ID and T1060758.DT_DIM_ID = nvl(T1060740.DEPT_ENTRY_DT_DIM_ID , 0)) and ASSOC_TYPE_DESC = $2',
        values: [req.params.date, req.params.assoc]
    }
    db.query(getMonthendReport, (err, data) => {
        if (err) {
            return next(err)
        }
        res.statuscode = 200;
        res.setHeader('Content-Type', 'application/json');
        res.send(data.rows)
    })
})

module.exports = router;